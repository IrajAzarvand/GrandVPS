{% extends "main_template.html" %}
{% load static %}

{% block title %}تنظیمات - سرویس ابری{% endblock %}

{% block content %}
<div class="profile-wrapper">
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <div class="user-profile">
                <div class="user-avatar">{{ user.get_full_name|slice:":2"|default:user.username|slice:":2"|upper }}</div>
                <div class="user-info">
                    <h3>{{ user.get_full_name|default:user.username }}</h3>
                    <p>کاربر سیستم</p>
                </div>
            </div>
        </div>

        <nav class="sidebar-nav">
            <a href="{% url 'dashboard:dashboard' %}" class="nav-item">
                <i class="fas fa-tachometer-alt"></i>
                <span>داشبورد</span>
            </a>
            <a href="{% url 'vps:dashboard' %}" class="nav-item">
                <i class="fas fa-server"></i>
                <span>سرویس‌های من</span>
            </a>
            <a href="{% url 'billing:history' %}" class="nav-item">
                <i class="fas fa-file-invoice-dollar"></i>
                <span>صورتحساب‌ها</span>
            </a>
            <a href="{% url 'wallet:dashboard' %}" class="nav-item">
                <i class="fas fa-wallet"></i>
                <span>کیف پول</span>
            </a>
            <a href="{% url 'dashboard:profile' %}" class="nav-item">
                <i class="fas fa-user-circle"></i>
                <span>پروفایل</span>
            </a>
            <a href="{% url 'dashboard:settings' %}" class="nav-item active">
                <i class="fas fa-cog"></i>
                <span>تنظیمات</span>
            </a>
            <a href="#" class="nav-item">
                <i class="fas fa-headset"></i>
                <span>پشتیبانی</span>
            </a>
            <a href="{% url 'accounts:logout' %}" class="nav-item">
                <i class="fas fa-sign-out-alt"></i>
                <span>خروج</span>
            </a>
        </nav>
    </aside>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Header -->
        <header class="dashboard-header">
            <div class="header-left">
                <button class="mobile-menu-toggle">
                    <i class="fas fa-bars"></i>
                </button>
                <div>
                    <h1>تنظیمات حساب</h1>
                    <p>مدیریت تنظیمات و ترجیحات حساب کاربری</p>
                </div>
            </div>

            <div class="header-right">
                <div class="theme-toggle" id="themeToggle">
                    <i class="fas fa-moon toggle-icon" id="themeIcon"></i>
                    <span class="toggle-text" id="themeText">&nbsp;</span>
                </div>
            </div>
        </header>

        <!-- Settings Content -->
        <div class="dashboard-content">
            <div class="settings-content">
                <!-- Account Settings -->
                <div class="settings-section">
                    <h2 class="section-title">
                        <i class="fas fa-user-cog"></i>
                        تنظیمات حساب
                    </h2>

                    <div class="settings-grid">
                        <div class="setting-card">
                            <div class="setting-header">
                                <h3>حذف حساب کاربری</h3>
                                <p>حذف دائمی حساب کاربری و تمام داده‌های مرتبط</p>
                            </div>
                            <button class="btn btn-outline btn-sm" onclick="confirmDeleteAccount()">
                                حذف حساب
                            </button>
                        </div>

                        <div class="setting-card">
                            <div class="setting-header">
                                <h3>دانلود داده‌ها</h3>
                                <p>دریافت نسخه‌ای از تمام داده‌های حساب کاربری</p>
                            </div>
                            <button class="btn btn-outline btn-sm">
                                دانلود داده‌ها
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Preferences -->
                <div class="settings-section">
                    <h2 class="section-title">
                        <i class="fas fa-palette"></i>
                        ترجیحات
                    </h2>

                    <div class="settings-grid">
                        <div class="setting-card">
                            <div class="setting-header">
                                <h3>زبان رابط کاربری</h3>
                                <p>انتخاب زبان نمایش سیستم</p>
                            </div>
                            <select class="form-input" style="width: 200px;">
                                <option value="fa" selected>فارسی</option>
                                <option value="en">English</option>
                            </select>
                        </div>

                        <div class="setting-card">
                            <div class="setting-header">
                                <h3>منطقه زمانی</h3>
                                <p>تنظیم منطقه زمانی نمایش</p>
                            </div>
                            <select class="form-input" style="width: 200px;">
                                <option value="Asia/Tehran" selected>تهران (UTC+3:30)</option>
                                <option value="UTC">UTC</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Security Settings -->
                <div class="settings-section">
                    <h2 class="section-title">
                        <i class="fas fa-shield-alt"></i>
                        تنظیمات امنیتی
                    </h2>

                    <div class="settings-grid">
                        <div class="setting-card">
                            <div class="setting-header">
                                <h3>ورود دو مرحله‌ای</h3>
                                <p>افزایش امنیت حساب با احراز هویت دو مرحله‌ای</p>
                            </div>
                            <div class="setting-toggle">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="two_factor">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>

                        <div class="setting-card">
                            <div class="setting-header">
                                <h3>اعلان‌های امنیتی</h3>
                                <p>دریافت اعلان برای فعالیت‌های مشکوک</p>
                            </div>
                            <div class="setting-toggle">
                                <label class="toggle-switch">
                                    <input type="checkbox" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- API Settings -->
                <div class="settings-section">
                    <h2 class="section-title">
                        <i class="fas fa-code"></i>
                        تنظیمات API
                    </h2>

                    <div class="settings-grid">
                        <div class="setting-card full-width">
                            <div class="setting-header">
                                <h3>کلید API</h3>
                                <p>کلید دسترسی به API های سیستم</p>
                            </div>
                            <div class="api-key-container">
                                <input type="text" class="form-input" value="sk-******************************" readonly style="width: 300px;">
                                <button class="btn btn-outline btn-sm">تولید کلید جدید</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.settings-content {
    max-width: 100%;
}

.settings-section {
    margin-bottom: 3rem;
}

.settings-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 1.5rem;
    margin-top: 1.5rem;
}

.setting-card {
    background: linear-gradient(145deg, rgba(30, 30, 46, 0.8) 0%, rgba(21, 21, 34, 0.8) 100%);
    border-radius: 12px;
    padding: 1.5rem;
    border: 1px solid rgba(0, 170, 255, 0.15);
    backdrop-filter: blur(10px);
}

.light-mode .setting-card {
    background: var(--card-light);
    border: 1px solid var(--border-light);
}

.setting-card.full-width {
    grid-column: 1 / -1;
}

.setting-header h3 {
    color: var(--text-light);
    margin-bottom: 0.5rem;
    font-size: 1.1rem;
}

.light-mode .setting-header h3 {
    color: var(--text-dark);
}

.setting-header p {
    color: var(--text-muted);
    font-size: 0.9rem;
    margin-bottom: 1rem;
}

.light-mode .setting-header p {
    color: var(--text-gray);
}

.setting-toggle {
    display: flex;
    justify-content: flex-end;
}

.api-key-container {
    display: flex;
    gap: 10px;
    align-items: center;
}

/* Responsive */
@media (max-width: 768px) {
    .settings-grid {
        grid-template-columns: 1fr;
    }

    .api-key-container {
        flex-direction: column;
        align-items: flex-start;
    }

    .api-key-container input {
        width: 100% !important;
    }
}
</style>

<script>
function confirmDeleteAccount() {
    if (confirm('آیا مطمئن هستید که می‌خواهید حساب کاربری خود را حذف کنید؟ این عمل قابل بازگشت نیست.')) {
        // Handle account deletion
        alert('درخواست حذف حساب ارسال شد. تیم پشتیبانی با شما تماس خواهد گرفت.');
    }
}

// Theme toggle functionality
document.addEventListener('DOMContentLoaded', function() {
    // Mobile menu toggle
    const mobileMenuToggle = document.querySelector('.mobile-menu-toggle');
    const sidebar = document.querySelector('.sidebar');

    if (mobileMenuToggle && sidebar) {
        mobileMenuToggle.addEventListener('click', function() {
            sidebar.classList.toggle('active');
        });

        // Close sidebar when clicking outside on mobile
        document.addEventListener('click', function(event) {
            if (window.innerWidth <= 1024) {
                if (!sidebar.contains(event.target) && !mobileMenuToggle.contains(event.target)) {
                    sidebar.classList.remove('active');
                }
            }
        });
    }

    // Theme toggle functionality
    const themeToggle = document.getElementById('themeToggle');
    const themeIcon = document.getElementById('themeIcon');
    const themeText = document.getElementById('themeText');

    if (themeToggle && themeIcon && themeText) {
        // Check for saved theme preference or default to dark
        const currentTheme = localStorage.getItem('theme') || 'dark';

        // Apply the saved theme on page load
        if (currentTheme === 'light') {
            document.body.classList.add('light-mode');
            themeIcon.classList.remove('fa-moon');
            themeIcon.classList.add('fa-sun');
            themeText.textContent = '';
        }

        // Toggle theme on button click
        themeToggle.addEventListener('click', function() {
            document.body.classList.toggle('light-mode');

            if (document.body.classList.contains('light-mode')) {
                themeIcon.classList.remove('fa-moon');
                themeIcon.classList.add('fa-sun');
                themeText.textContent = '';
                localStorage.setItem('theme', 'light');
            } else {
                themeIcon.classList.remove('fa-sun');
                themeIcon.classList.add('fa-moon');
                themeText.textContent = '';
                localStorage.setItem('theme', 'dark');
            }
        });
    }
});
</script>
{% endblock %}